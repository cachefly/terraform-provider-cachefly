---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "cachefly_service Resource - terraform-provider-cachefly"
subcategory: ""
description: |-
  A service represents a CDN configuration that defines how content is cached and delivered.
---

# cachefly_service (Resource)

A service represents a CDN configuration that defines how content is cached and delivered.

## Example Usage

```terraform
# ===================================================================
# CacheFly CDN - Service Setup Examples
# ===================================================================

terraform {
  required_version = ">= 1.0"
  required_providers {
    cachefly = {
      source = "cachefly/cachefly"
    }
  }
}

provider "cachefly" {
  # Uses CACHEFLY_API_TOKEN if set; otherwise, set api_token here
  # api_token = ""
}

# -------------------------------------------------------------------
# Data Sources: Delivery Regions (optional helper)
# -------------------------------------------------------------------
data "cachefly_delivery_regions" "available" {}

# -------------------------------------------------------------------
# Example 1: Basic Service
# -------------------------------------------------------------------
resource "cachefly_service" "basic" {
  name        = "example-dev-svc"
  unique_name = "example-dev-svc-basic"
  description = "Basic CDN service example"
  auto_ssl    = true
}

# -------------------------------------------------------------------
# Example 2: Service with Options and Delivery Region
# -------------------------------------------------------------------
resource "cachefly_service" "with_options" {
  name        = "example-dev-svc-opts"
  unique_name = "example-dev-svc-opts"
  description = "Service with advanced options enabled"
  auto_ssl    = true

  # Optionally pin the service to a delivery region (pick first available)
  delivery_region = data.cachefly_delivery_regions.available.regions[0].id

  # Optionally set a TLS profile if you have a specific profile ID
  # tls_profile = "<tls-profile-id>"

  # Example options (see Service Options Reference in docs)
  options = {
    autoRedirect = true

    reverseProxy = {
      enabled           = true
      originScheme      = "HTTP"
      cacheByQueryParam = true
      useRobotsTxt      = true
      ttl               = 123
      hostname          = "example.com"
    }

    protectServeKeyEnabled = true

    purgemode = {
      enabled = true
      value = {
        exact     = true
        directory = true
        extension = true
      }
    }
  }
}

# -------------------------------------------------------------------
# Outputs
# -------------------------------------------------------------------
output "services" {
  value = {
    basic = {
      id          = cachefly_service.basic.id
      name        = cachefly_service.basic.name
      unique_name = cachefly_service.basic.unique_name
      status      = cachefly_service.basic.status
      created     = cachefly_service.basic.created_at
      updated     = cachefly_service.basic.updated_at
    }
    with_options = {
      id                  = cachefly_service.with_options.id
      name                = cachefly_service.with_options.name
      unique_name         = cachefly_service.with_options.unique_name
      status              = cachefly_service.with_options.status
      configuration_mode  = cachefly_service.with_options.configuration_mode
      delivery_region     = cachefly_service.with_options.delivery_region
      created             = cachefly_service.with_options.created_at
      updated             = cachefly_service.with_options.updated_at
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) The display name of the service.
- `unique_name` (String) The unique name of the service used in URLs and configurations. Must be unique across all services.

### Optional

- `auto_ssl` (Boolean) Whether to automatically provision SSL certificates.
- `delivery_region` (String) The delivery region for the service.
- `description` (String) A description of the service.
- `options` (Dynamic) Service options as a map. See [Options](#options) for full option catalog, types, allowed values, and constraints.
- `status` (String) The current status of the service. Set this to 'ACTIVE' to activate the service or 'DEACTIVATED' to deactivate it.
- `tls_profile` (String) The TLS profile to use for SSL connections.

## Options

### reverseProxy (Object)

Reverse proxy configuration. When `enabled = true`, the following fields are required unless stated otherwise.

- enabled (Boolean) — required
- hostname (String) — required
- originScheme (String) — required; one of: FOLLOW, HTTP, HTTPS
- ttl (Number) — required; cache TTL in seconds
- useRobotsTxt (Boolean) — required
- cacheByQueryParam (Boolean) — required
- mode (String) — optional; one of: WEB, OBJECT_STORAGE
  - If `mode = OBJECT_STORAGE`, the following are also required:
    - accessKey (String)
    - secretKey (String)
    - region (String)
 - prepend (String) — optional; path to prepend to origin requests
 - authorization (Object) — optional; used for origin authorization
   - type (String) — e.g., "NONE"; additional fields may be introduced based on type

Examples:

WEB origin

```hcl
options = {
  reverseProxy = {
    enabled           = true
    mode              = "WEB"
    hostname          = "origin.example.com"
    originScheme      = "HTTPS"    # FOLLOW | HTTP | HTTPS
    ttl               = 3600
    useRobotsTxt      = false
    cacheByQueryParam = true
    prepend           = "/static"
    authorization     = {
      type = "NONE"
    }
  }
}
```

Object Storage origin

```hcl
options = {
  reverseProxy = {
    enabled           = true
    mode              = "OBJECT_STORAGE"
    hostname          = "bucket.example.com"
    originScheme      = "HTTPS"
    ttl               = 3600
    useRobotsTxt      = false
    cacheByQueryParam = true

    accessKey = var.object_storage_access_key
    secretKey = var.object_storage_secret_key
    region    = "us-east-1"
  }
}
```

### ttfb_timeout (Object)

- enabled (Boolean)
- value (Number) — time-to-first-byte timeout in seconds

### contimeout (Object)

- enabled (Boolean)
- value (Number) — connect timeout in seconds

### sharedshield (Object)

- enabled (Boolean)
- value (String) — shield location (e.g., "ORD")

### bwthrottle (Object)

- enabled (Boolean)
- value (Number) — throttle rate

### purgemode (Object)

- enabled (Boolean)
- value — can be provider/account specific. Two common shapes:
  - String code (e.g., "2")
  - Object flags (e.g., `{ exact = true, directory = true, extension = true }`)

Examples:

```hcl
options = {
  purgemode = {
    enabled = true
    value   = "2"
  }
}
```

```hcl
options = {
  purgemode = {
    enabled = true
    value = {
      exact     = true
      directory = true
      extension = true
    }
  }
}
```

### dirpurgeskip (Object)

- enabled (Boolean)
- value (Number)

### skip_pserve_ext (Object)

- enabled (Boolean)
- value (List of String) — file extensions to skip ProtectServe

### httpmethods (Object)

- enabled (Boolean)
- value (Object) — per-method allow flags

Example:

```hcl
options = {
  httpmethods = {
    enabled = true
    value = {
      GET     = true
      HEAD    = true
      OPTIONS = true
      PUT     = false
      POST    = false
      PATCH   = false
      DELETE  = false
    }
  }
}
```

### bwthrottlequery (Object)

- enabled (Boolean)
- value (List of String)

### originhostheader (Object)

- enabled (Boolean)
- value (List of String)

### redirect (Object)

- enabled (Boolean)
- value (String) — redirect URL

### skip_encoding_ext (Object)

- enabled (Boolean)
- value (List of String)

### custom_server_label (Object)

- enabled (Boolean)
- value (String)

### allow_encoding_ext (Object)

- enabled (Boolean)
- value (List of String)

### Other Options

- protectServeKeyEnabled (Boolean)
  - Enables ProtectServe. When set to true, the provider regenerates the ProtectServe key; when set to false, the key is deleted.

- cors (Boolean)
  - Enables CORS override for the service.

- referrerBlocking (Boolean)
  - Blocks requests based on referrer rules.

- autoRedirect (Boolean)
  - Automatically redirects HTTP to HTTPS.


- brotli_compression (Boolean)
  - Enables Brotli compression at the edge.

- brotli_support (Boolean)
  - Enables Brotli content negotiation support.

- livestreaming (Boolean)
  - Enables live streaming optimizations.

- nocache (Boolean)
  - Disables caching of responses.

- cachebygeocountry (Boolean)
  - Varies cache by geo country.

- cachebyregion (Boolean)
  - Varies cache by region.

- cachebyreferer (Boolean)
  - Varies cache by HTTP Referer.

- normalizequerystring (Boolean)
  - Normalizes query strings for cache keys.

- allowretry (Boolean)
  - Allows retrying failed origin requests.

- linkpreheat (Boolean)
  - Enables link preheating.

- edgetoorigin (Boolean)
  - Sends requests directly from edge to origin for certain flows.

- followredirect (Boolean)
  - Follows origin redirects.

- purgenoquery (Boolean)
  - Ignores query string when purging.

- forceorigqstring (Boolean)
  - Forces original query string to origin.

- servestale (Boolean)
  - Serves stale content when origin is unavailable.

- cachepostrequests (Boolean)
  - Enables caching of POST requests.

- "send-xff" (Boolean)
  - Sends X-Forwarded-For header. Note: the key contains a hyphen; in Terraform HCL map literals, quote the key (as shown).

- usecfdootencoding (Boolean)
  - Enables CF dot-encoding handling.

- skip_urlencoding (Boolean)
  - Skips URL encoding on the edge.

- skip_encoding (Boolean)
  - Skips content encoding.

- hsts (Boolean)
  - Enables HTTP Strict Transport Security.

## Notes and mappings

- API/UI naming vs Terraform keys (for reference):
  - Reverse Proxy → `reverseProxy`
  - ProtectServe → `protectServeKeyEnabled`
  - CORS Override → `cors`
  - Referrer Blocking → `referrerBlocking`
  - Auto HTTPS Redirect → `autoRedirect`

- The available options can vary by service and account. If an option is unsupported for a given service, the provider will report a validation error during apply.

- Some options may introduce additional fields or constraints over time. When in doubt, prefer the examples above and consult the provider changelog.

### Read-Only

- `configuration_mode` (String) The configuration mode for the service.
- `created_at` (String) The timestamp when the service was created.
- `id` (String) The unique identifier of the service.
- `updated_at` (String) The timestamp when the service was last updated.
